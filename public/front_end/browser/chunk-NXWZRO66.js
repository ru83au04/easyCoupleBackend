import{a as V}from"./chunk-VH44NRLS.js";import{$ as d,$a as u,Ca as w,Fb as T,Ga as y,Gb as N,Hb as O,Ib as j,Jb as D,Kb as L,Lb as z,Mb as A,Na as _,O as B,Oa as a,Pa as o,Ra as C,Sa as f,Ta as c,Xa as h,Ya as M,_ as p,_a as g,ab as m,e as v,ea as S,k as E,ta as l,ua as x,ub as F,vb as U}from"./chunk-JQBQYFJU.js";var P=class s{currentUserSubject;currentUser;constructor(){}loginUser(i){this.currentUserSubject=new E(i),this.currentUser=this.currentUserSubject.asObservable()}logoutUser(){this.currentUserSubject?.unsubscribe(),this.currentUser=void 0}static \u0275fac=function(e){return new(e||s)};static \u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"})},W=(n=>(n[n.employee=1]="employee",n[n.manager=2]="manager",n[n.admin=3]="admin",n))(W||{}),R=(n=>(n[n.department1=1]="department1",n[n.department2=2]="department2",n[n.department3=3]="department3",n))(R||{});function K(s,i){if(s&1){let e=C();a(0,"div",3)(1,"input",4),m("ngModelChange",function(t){p(e);let r=c();return u(r.username,t)||(r.username=t),d(t)}),o(),a(2,"input",5),m("ngModelChange",function(t){p(e);let r=c();return u(r.password,t)||(r.password=t),d(t)}),o(),a(3,"input",6),m("ngModelChange",function(t){p(e);let r=c();return u(r.checkPassword,t)||(r.checkPassword=t),d(t)}),o(),a(4,"button",7),f("click",function(){p(e);let t=c();return d(t.checkUser())}),h(5,"\u8A3B\u518A"),o()()}if(s&2){let e=c();l(),g("ngModel",e.username),l(),g("ngModel",e.password),l(),g("ngModel",e.checkPassword)}}function Q(s,i){if(s&1&&(a(0,"option",19),h(1),o()),s&2){let e=i.$implicit;_("value",e),l(),M(e)}}function X(s,i){if(s&1&&(a(0,"option",19),h(1),o()),s&2){let e=i.$implicit;_("value",e),l(),M(e)}}function Y(s,i){if(s&1){let e=C();a(0,"div",8)(1,"input",9),m("ngModelChange",function(t){p(e);let r=c();return u(r.username,t)||(r.username=t),d(t)}),o(),a(2,"input",10),m("ngModelChange",function(t){p(e);let r=c();return u(r.password,t)||(r.password=t),d(t)}),o(),a(3,"input",11),m("ngModelChange",function(t){p(e);let r=c();return u(r.real_name,t)||(r.real_name=t),d(t)}),o(),a(4,"input",12),m("ngModelChange",function(t){p(e);let r=c();return u(r.phone,t)||(r.phone=t),d(t)}),o(),a(5,"input",13),m("ngModelChange",function(t){p(e);let r=c();return u(r.emergency,t)||(r.emergency=t),d(t)}),o(),a(6,"input",14),m("ngModelChange",function(t){p(e);let r=c();return u(r.emergency_phone,t)||(r.emergency_phone=t),d(t)}),o(),a(7,"input",15),m("ngModelChange",function(t){p(e);let r=c();return u(r.address,t)||(r.address=t),d(t)}),o(),a(8,"input",16),m("ngModelChange",function(t){p(e);let r=c();return u(r.start_date,t)||(r.start_date=t),d(t)}),o(),a(9,"select",17),m("ngModelChange",function(t){p(e);let r=c();return u(r.role,t)||(r.role=t),d(t)}),y(10,Q,2,2,"option",18),o(),a(11,"select",17),m("ngModelChange",function(t){p(e);let r=c();return u(r.department,t)||(r.department=t),d(t)}),y(12,X,2,2,"option",18),o(),a(13,"button",7),f("click",function(){p(e);let t=c();return d(t.registUser())}),h(14,"\u78BA\u8A8D"),o()()}if(s&2){let e=c();l(),g("ngModel",e.username),l(),g("ngModel",e.password),l(),g("ngModel",e.real_name),l(),g("ngModel",e.phone),l(),g("ngModel",e.emergency),l(),g("ngModel",e.emergency_phone),l(),g("ngModel",e.address),l(),g("ngModel",e.start_date),l(),g("ngModel",e.role),l(),_("ngForOf",e.roles),l(),g("ngModel",e.department),l(),_("ngForOf",e.departments)}}var k=class s{constructor(i){this.userSrv=i;this.roles=Object.keys(W).filter(e=>isNaN(Number(e))),this.departments=Object.keys(R).filter(e=>isNaN(Number(e)))}finishRegist=new S;roles;departments;checkPassword;username="";password="";real_name="";phone;emergency="";emergency_phone;address="";start_date=new Date;role;department;detail=!1;ngOnInit(){}checkUser(){if(this.username&&this.password&&this.checkPassword===this.password)try{this.userSrv.checkUser(this.username,this.password).subscribe({next:i=>{i.status===200?i.data[0]?(console.log("\u4F7F\u7528\u8005\u5DF2\u5B58\u5728"),this.finish(!1,"\u4F7F\u7528\u8005\u5DF2\u5B58\u5728")):(this.checkPassword="",this.detail=!0):(console.log("\u4E0D\u660E\u554F\u984C"),this.finish(!1,"\u4E0D\u660E\u554F\u984C"))},error:i=>{console.log(`\u78BA\u8A8D\u5931\u6557\uFF1A${i.status}`,i.message),this.finish(!1,`\u78BA\u8A8D\u5931\u6557\uFF1A${i.status}`)}})}catch(i){console.error("\u78BA\u8A8D\u5931\u6557",i),this.finish(!1,"\u78BA\u8A8D\u5931\u6557")}else console.log("\u8ACB\u78BA\u8A8D\u5E33\u865F\u3001\u5BC6\u78BC\u6216\u78BA\u8A8D\u5BC6\u78BC"),this.finish(!1,"\u8ACB\u78BA\u8A8D\u5E33\u865F\u3001\u5BC6\u78BC\u6216\u78BA\u8A8D\u5BC6\u78BC")}registUser(){if(this.username&&this.password&&this.real_name!=""&&this.emergency!=""){let i={username:this.username,password:this.password,real_name:this.real_name,phone:this.phone,emergency:this.emergency,emergency_phone:this.emergency_phone,address:this.address,start_date:this.start_date,role_id:W[this.role],department_id:R[this.department]};try{this.userSrv.registUser(i).subscribe({next:e=>{e.status===200?(console.log("\u8A3B\u518A\u6210\u529F"),this.username="",this.password="",this.real_name="",this.phone=void 0,this.emergency="",this.emergency_phone=void 0,this.address="",this.start_date=new Date,this.role="",this.department="",this.finish(!0,"\u8A3B\u518A\u6210\u529F")):this.finish(!1,"\u8A3B\u518A\u5931\u6557")},error:e=>{this.finish(!1,"\u8A3B\u518A\u5931\u6557\uFF1A"+e.message)}})}catch(e){this.finish(!1,"\u8A3B\u518A\u5931\u6557"),console.error("\u8A3B\u518A\u5931\u6557",e)}}else console.log("\u8A3B\u518A\u8CC7\u6599\u4E0D\u5B8C\u6574"),this.finish(!1,"\u8A3B\u518A\u8CC7\u6599\u4E0D\u5B8C\u6574")}finish(i,e){this.finishRegist.emit({result:i,message:e})}static \u0275fac=function(e){return new(e||s)(x(V))};static \u0275cmp=w({type:s,selectors:[["app-regist"]],outputs:{finishRegist:"finishRegist"},decls:3,vars:2,consts:[[1,"container"],["class","step1",4,"ngIf"],["class","step2",4,"ngIf"],[1,"step1"],["type","text","placeholder","\u8F38\u5165\u5E33\u865F",3,"ngModelChange","ngModel"],["type","password","placeholder","\u8F38\u5165\u5BC6\u78BC",3,"ngModelChange","ngModel"],["type","password","placeholder","\u518D\u6B21\u8F38\u5165\u5BC6\u78BC",3,"ngModelChange","ngModel"],[3,"click"],[1,"step2"],["type","text","placeholder","\u8F38\u5165\u5E33\u865F","disabled","",3,"ngModelChange","ngModel"],["type","password","placeholder","\u8F38\u5165\u5BC6\u78BC","disabled","",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8F38\u5165\u59D3\u540D",3,"ngModelChange","ngModel"],["type","number","placeholder","\u8F38\u5165\u96FB\u8A71",3,"ngModelChange","ngModel"],["type","text","placeholder","\u7DCA\u6025\u806F\u7D61\u4EBA",3,"ngModelChange","ngModel"],["type","number","placeholder","\u7DCA\u6025\u806F\u7D61\u4EBA\u96FB\u8A71",3,"ngModelChange","ngModel"],["type","text","placeholder","\u8F38\u5165\u5730\u5740",3,"ngModelChange","ngModel"],["type","date","placeholder","\u8F38\u5165\u5230\u8077\u65E5",3,"ngModelChange","ngModel"],["type","text",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,n){e&1&&(a(0,"div",0),y(1,K,6,3,"div",1)(2,Y,15,12,"div",2),o()),e&2&&(l(),_("ngIf",!n.detail),l(),_("ngIf",n.detail))},dependencies:[A,L,z,T,j,D,N,O,U,F],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.step1[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column;justify-content:center;align-items:center;border-radius:30px;border:1px solid #ccc;width:500px}.step2[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}input[_ngcontent-%COMP%]{margin:10px;padding:10px;border-radius:5px;border:1px solid #ccc;width:200px;height:10px}button[_ngcontent-%COMP%]{margin:10px}"]})};var b=class s{closeAlert=new S;alertMessage="";constructor(){}Alert(i){i()}close(){this.closeAlert.emit(!1)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=w({type:s,selectors:[["app-user-alert"]],inputs:{alertMessage:"alertMessage"},outputs:{closeAlert:"closeAlert"},decls:7,vars:1,consts:[[1,"outer"],[1,"alert_container"],[3,"click"]],template:function(e,n){e&1&&(a(0,"div")(1,"div",0)(2,"div",1)(3,"div"),h(4),o()(),a(5,"button",2),f("click",function(){return n.close()}),h(6,"\u78BA\u5B9A"),o()()()),e&2&&(l(4),M(n.alertMessage))},styles:[".outer[_ngcontent-%COMP%]{height:150px;width:250px;position:absolute;background-color:#f8f9fa;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;padding:3px;flex-direction:column;border:1px solid #ccc;border-radius:10px;box-shadow:0 0 10px #0000001a;z-index:999}.alert_container[_ngcontent-%COMP%]{display:grid;align-items:center;height:100%;padding:20px;background-color:#f8f9fa;color:#000;font-size:16px;font-weight:500;justify-items:center;text-align:center}button[_ngcontent-%COMP%]{height:40px;border:1px solid #ccc;border-radius:5px;background-color:#d2e0ed}"]})};function Z(s,i){if(s&1){let e=C();a(0,"div")(1,"app-regist",3),f("finishRegist",function(t){p(e);let r=c();return d(r.onFinishRegist(t))}),o()()}}function $(s,i){if(s&1){let e=C();a(0,"app-user-alert",4),f("closeAlert",function(t){p(e);let r=c();return d(r.onClosedAlert(t))}),o()}if(s&2){let e=c();_("alertMessage",e.alertMessage)}}var G=class s{constructor(i,e){this.userSrv=i;this.authSrv=e}alert=new b;alertMessage="";name;password;checkPassword;loginName="";loginPassword="";register=!1;deleteId=0;searchId=0;showAlert=!1;showRegistPage=!1;ngOnInit(){}showRegist(){this.showRegistPage=!0}onFinishRegist(i){let e=i;e.result?(this.alertMessage=e.message,this.alert.Alert(()=>{this.showRegistPage=!1})):(this.alertMessage=e.message,this.alert.Alert(()=>{})),this.showAlert=!0}onClosedAlert(i){this.showAlert=i}loginUser(){return v(this,null,function*(){if(this.loginName===""||this.loginPassword===""){console.log("\u8ACB\u8F38\u5165\u5E33\u865For\u5BC6\u78BC");return}try{this.userSrv.loginUser(this.loginName,this.loginPassword).subscribe({next:i=>{i.status===200?(console.log("\u767B\u5165\u6210\u529F"),localStorage.setItem("token",i.data[0]),this.loginName="",this.loginPassword=""):console.log("\u4E0D\u660E\u932F\u8AA4")},error:i=>{throw console.log(`\u767B\u5165\u5931\u6557\uFF1A${i.status}`,i.message),i}})}catch(i){console.error("\u767B\u5165\u5931\u6557",i)}})}getUserInfo(i){return v(this,null,function*(){try{let e=localStorage.getItem("token");if(!e){console.log("\u8ACB\u5148\u767B\u5165");return}this.userSrv.getUserInfo(e,i).subscribe({next:n=>{if(n.status===200){console.log("\u67E5\u8A62\u6210\u529F");let t=n.data[0];this.authSrv.loginUser(t)}else console.log("\u67E5\u8A62\u5931\u6557")},error:n=>{throw console.log(`\u67E5\u8A62\u5931\u6557\uFF1A${n.status}`,n.message),n}})}catch(e){console.error("\u67E5\u8A62\u5931\u6557",e)}})}deleteUser(i){return v(this,null,function*(){try{let e=localStorage.getItem("token");if(!e){console.log("\u8ACB\u5148\u767B\u5165");return}i&&i!==0?this.userSrv.deleteUser(e,i).subscribe({next:n=>{n.status===200?console.log("\u522A\u9664\u6210\u529F"):console.log("\u4E0D\u660E\u539F\u56E0\u522A\u9664\u5931\u6557")},error:n=>{throw console.log(`\u522A\u9664\u5931\u6557\uFF1A${n.status}`,n.message),n}}):console.log("\u8ACB\u8F38\u5165\u6709\u6548ID")}catch(e){console.error("\u522A\u9664\u5931\u6557",e)}})}logoutUser(){this.authSrv.logoutUser(),localStorage.removeItem("token")}static \u0275fac=function(e){return new(e||s)(x(V),x(P))};static \u0275cmp=w({type:s,selectors:[["app-user-system"]],decls:6,vars:2,consts:[[3,"click"],[4,"ngIf"],[3,"alertMessage","closeAlert",4,"ngIf"],[3,"finishRegist"],[3,"closeAlert","alertMessage"]],template:function(e,n){e&1&&(a(0,"div")(1,"div")(2,"button",0),f("click",function(){return n.showRegist()}),h(3,"\u8A3B\u518A"),o()(),y(4,Z,2,0,"div",1),o(),y(5,$,1,1,"app-user-alert",2)),e&2&&(l(4),_("ngIf",n.showRegistPage),l(),_("ngIf",n.showAlert))},dependencies:[A,U,k,b],encapsulation:2})};export{G as UserSystemComponent};

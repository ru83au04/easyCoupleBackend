import{d as H,i as M}from"./chunk-JO4J3DXD.js";import{$ as g,$a as _,Ca as y,Ga as b,Gb as V,Hb as k,Ib as R,Jb as z,Kb as q,Lb as G,Mb as v,Na as u,O as N,Oa as s,Pa as a,Ra as x,Sa as m,Ta as c,Ua as W,Ya as d,Za as P,_ as p,ab as f,bb as h,e as S,ea as w,k as F,ta as l,ua as C,vb as j,wb as E}from"./chunk-YATWYMKV.js";var I=class o{currentUserSubject;currentUser;constructor(){}loginUser(n){this.currentUserSubject=new F(n),this.currentUser=this.currentUserSubject.asObservable()}logoutUser(){this.currentUserSubject?.unsubscribe(),this.currentUser=void 0}static \u0275fac=function(e){return new(e||o)};static \u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"})},T=(t=>(t[t.employee=1]="employee",t[t.manager=2]="manager",t[t.admin=3]="admin",t))(T||{}),L=(t=>(t[t.department1=1]="department1",t[t.department2=2]="department2",t[t.department3=3]="department3",t))(L||{});function Y(o,n){if(o&1){let e=x();s(0,"div",3)(1,"input",4),h("ngModelChange",function(i){p(e);let r=c();return f(r.username,i)||(r.username=i),g(i)}),a(),s(2,"input",5),h("ngModelChange",function(i){p(e);let r=c();return f(r.password,i)||(r.password=i),g(i)}),a(),s(3,"input",6),h("ngModelChange",function(i){p(e);let r=c();return f(r.checkPassword,i)||(r.checkPassword=i),g(i)}),a(),s(4,"div",7)(5,"button",8),m("click",function(){p(e);let i=c();return g(i.checkUser())}),d(6,"\u8A3B\u518A"),a(),s(7,"button",8),m("click",function(){p(e);let i=c();return g(i.cancelRegist())}),d(8,"\u53D6\u6D88"),a()()()}if(o&2){let e=c();l(),_("ngModel",e.username),l(),_("ngModel",e.password),l(),_("ngModel",e.checkPassword)}}function Z(o,n){if(o&1&&(s(0,"option",20),d(1),a()),o&2){let e=n.$implicit;u("value",e),l(),P(e)}}function $(o,n){if(o&1&&(s(0,"option",20),d(1),a()),o&2){let e=n.$implicit;u("value",e),l(),P(e)}}function ee(o,n){if(o&1){let e=x();s(0,"input",21),h("ngModelChange",function(i){let r=p(e).$implicit;return f(r.name,i)||(r.name=i),g(i)}),a()}if(o&2){let e=n.$implicit;W("type",e.type),W("placeholder",e.placeholder),_("ngModel",e.name)}}function te(o,n){if(o&1){let e=x();s(0,"div",9)(1,"div")(2,"input",10),h("ngModelChange",function(i){p(e);let r=c();return f(r.username,i)||(r.username=i),g(i)}),a(),s(3,"input",11),h("ngModelChange",function(i){p(e);let r=c();return f(r.password,i)||(r.password=i),g(i)}),a(),s(4,"div",12)(5,"div")(6,"label"),d(7,"\u8077\u52D9(\u5FC5\u586B)"),a(),s(8,"select",13),h("ngModelChange",function(i){p(e);let r=c();return f(r.role,i)||(r.role=i),g(i)}),s(9,"option",14),d(10,"\u8ACB\u9078\u64C7\u8077\u52D9"),a(),b(11,Z,2,2,"option",15),a()(),s(12,"div")(13,"label"),d(14,"\u90E8\u9580(\u5FC5\u586B)"),a(),s(15,"select",13),h("ngModelChange",function(i){p(e);let r=c();return f(r.department,i)||(r.department=i),g(i)}),s(16,"option",16),d(17,"\u8ACB\u9078\u64C7\u90E8\u9580"),a(),b(18,$,2,2,"option",15),a()(),s(19,"div")(20,"label"),d(21,"\u5230\u8077\u65E5\u671F"),a(),s(22,"input",17),h("ngModelChange",function(i){p(e);let r=c();return f(r.start_date,i)||(r.start_date=i),g(i)}),a()()()(),s(23,"div"),b(24,ee,1,3,"input",18),a(),s(25,"div")(26,"textarea",19),h("ngModelChange",function(i){p(e);let r=c();return f(r.address,i)||(r.address=i),g(i)}),a()(),s(27,"button",8),m("click",function(){p(e);let i=c();return g(i.registUser())}),d(28,"\u78BA\u8A8D"),a()()}if(o&2){let e=c();l(2),_("ngModel",e.username),l(),_("ngModel",e.password),l(5),_("ngModel",e.role),l(3),u("ngForOf",e.roles),l(4),_("ngModel",e.department),l(3),u("ngForOf",e.departments),l(4),_("ngModel",e.start_date),l(2),u("ngForOf",e.basicData),l(2),_("ngModel",e.address)}}var O=class o{constructor(n){this.userSrv=n;this.roles=Object.keys(T).filter(e=>isNaN(Number(e))),this.departments=Object.keys(L).filter(e=>isNaN(Number(e)))}finishRegist=new w;cancel=new w;roles;departments;checkPassword;username="";password="";address="";start_date=new Date;role;department;detail=!1;basicData=[{name:"",type:"text",placeholder:"\u771F\u5BE6\u59D3\u540D(\u5FC5\u586B)"},{name:123456789,type:"number",placeholder:"\u96FB\u8A71"},{name:"",type:"text",placeholder:"\u7DCA\u6025\u806F\u7D61\u4EBA(\u5FC5\u586B)"},{name:987654321,type:"number",placeholder:"\u7DCA\u6025\u806F\u7D61\u4EBA\u96FB\u8A71"}];ngOnInit(){}checkUser(){if(this.username&&this.password&&this.checkPassword===this.password)try{this.userSrv.checkUser(this.username,this.password).subscribe({next:n=>{n.status===200?n.data[0]?(console.log("\u4F7F\u7528\u8005\u5DF2\u5B58\u5728"),this.finish(!1,"\u4F7F\u7528\u8005\u5DF2\u5B58\u5728")):(this.checkPassword="",this.detail=!0):(console.log("\u4E0D\u660E\u554F\u984C"),this.finish(!1,"\u4E0D\u660E\u554F\u984C"))},error:n=>{console.log(`\u78BA\u8A8D\u5931\u6557\uFF1A${n.status}`,n.message),this.finish(!1,`\u78BA\u8A8D\u5931\u6557\uFF1A${n.status}`)}})}catch(n){console.error("\u78BA\u8A8D\u5931\u6557",n),this.finish(!1,"\u78BA\u8A8D\u5931\u6557")}else console.log("\u8ACB\u78BA\u8A8D\u5E33\u865F\u3001\u5BC6\u78BC\u6216\u78BA\u8A8D\u5BC6\u78BC"),this.finish(!1,"\u8ACB\u78BA\u8A8D\u5E33\u865F\u3001\u5BC6\u78BC\u6216\u78BA\u8A8D\u5BC6\u78BC")}registUser(){if(this.username&&this.password&&this.basicData[0].name!=""&&this.basicData[2].name!=""){let n={username:this.username,password:this.password,real_name:this.basicData[0].name,phone:this.basicData[1].name,emergency:this.basicData[2].name,emergency_phone:this.basicData[3].name,address:this.address,start_date:this.start_date,role_id:T[this.role],department_id:L[this.department]};try{this.userSrv.registUser(n).subscribe({next:e=>{e.status===200?(this.username="",this.password="",this.basicData[0].name="",this.basicData[1].name=123456789,this.basicData[2].name="",this.basicData[3].name=987654312,this.address="",this.start_date=new Date,this.role="",this.department="",this.finish(!0,"\u8A3B\u518A\u6210\u529F")):this.finish(!1,"\u8A3B\u518A\u5931\u6557")},error:e=>{console.log(`\u8A3B\u518A\u5931\u6557\uFF1A ${e.status}`,e.error.message),this.finish(!1,`\u8A3B\u518A\u5931\u6557\uFF1A ${e.error.message}`)}})}catch(e){this.finish(!1,"\u8A3B\u518A\u5931\u6557"),console.error("\u8A3B\u518A\u5931\u6557",e)}}else console.log("\u8A3B\u518A\u8CC7\u6599\u4E0D\u5B8C\u6574"),this.finish(!1,"\u8A3B\u518A\u8CC7\u6599\u4E0D\u5B8C\u6574")}finish(n,e){this.finishRegist.emit({result:n,message:e})}cancelRegist(){this.cancel.emit(!1)}static \u0275fac=function(e){return new(e||o)(C(M))};static \u0275cmp=y({type:o,selectors:[["app-regist"]],outputs:{finishRegist:"finishRegist",cancel:"cancel"},decls:3,vars:2,consts:[[1,"container"],["class","regist-container",4,"ngIf"],["class","step2",4,"ngIf"],[1,"regist-container"],["type","text","placeholder","\u8F38\u5165\u5E33\u865F",3,"ngModelChange","ngModel"],["type","password","placeholder","\u8F38\u5165\u5BC6\u78BC",3,"ngModelChange","ngModel"],["type","password","placeholder","\u518D\u6B21\u8F38\u5165\u5BC6\u78BC",3,"ngModelChange","ngModel"],[1,"operation"],[3,"click"],[1,"step2"],["type","text","placeholder","\u8F38\u5165\u5E33\u865F","disabled","",3,"ngModelChange","ngModel"],["type","password","placeholder","\u8F38\u5165\u5BC6\u78BC","disabled","",3,"ngModelChange","ngModel"],[1,"select-container"],["type","text",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["value"," ","disabled","","selected",""],["type","date",3,"ngModelChange","ngModel"],[3,"type","ngModel","placeholder","ngModelChange",4,"ngFor","ngForOf"],["placeholder","\u8F38\u5165\u806F\u7D61\u5730\u5740",1,"address",3,"ngModelChange","ngModel"],[3,"value"],[3,"ngModelChange","type","ngModel","placeholder"]],template:function(e,t){e&1&&(s(0,"div",0),b(1,Y,9,3,"div",1)(2,te,29,9,"div",2),a()),e&2&&(l(),u("ngIf",!t.detail),l(),u("ngIf",t.detail))},dependencies:[v,q,G,V,z,k,R,E,j],styles:[".container[_ngcontent-%COMP%]{margin:10px;display:flex;justify-content:center;align-items:center}.regist-container[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column;justify-content:center;align-items:center;border-radius:30px;border:1px solid var(--text-color);width:300px}.operation[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.step2[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;width:500px}.select-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.address[_ngcontent-%COMP%]{margin:10px;padding:10px;border-radius:5px;border:1px solid #ccc;width:440px;height:40px}input[_ngcontent-%COMP%]{margin:10px;padding:10px;border-radius:5px;border:1px solid #ccc;width:200px;height:10px}select[_ngcontent-%COMP%]{background:#fff;width:200px;color:#000}"]})};var D=class o{constructor(n){this.userSrv=n}finishLogin=new w;cancel=new w;loginName="";loginPassword="";loginUser(){return S(this,null,function*(){if(this.loginName===""||this.loginPassword===""){this.finish(!1,"\u8ACB\u8F38\u5165\u5E33\u865For\u5BC6\u78BC");return}try{this.userSrv.loginUser(this.loginName,this.loginPassword).subscribe({next:n=>{n.status===200?(localStorage.setItem("token",n.data[0]),this.loginName="",this.loginPassword="",this.finish(!0,"\u767B\u5165\u6210\u529F")):(console.log("\u4E0D\u660E\u932F\u8AA4"),this.finish(!1,"\u4E0D\u660E\u932F\u8AA4"))},error:n=>{console.log(`\u767B\u5165\u5931\u6557\uFF1A${n.status}`,n.error.message),this.finish(!1,`\u767B\u5165\u5931\u6557\uFF1A${n.error.message}`)}})}catch(n){this.finish(!1,"\u767B\u5165\u5931\u6557"),console.error("\u767B\u5165\u5931\u6557",n)}})}cancelLogin(){this.cancel.emit(!1)}finish(n,e){this.finishLogin.emit({result:n,message:e})}static \u0275fac=function(e){return new(e||o)(C(M))};static \u0275cmp=y({type:o,selectors:[["app-login"]],outputs:{finishLogin:"finishLogin",cancel:"cancel"},decls:9,vars:2,consts:[[1,"container"],[1,"login-container"],["type","text","placeholder","\u8F38\u5165\u5E33\u865F",3,"ngModelChange","ngModel"],["type","password","placeholder","\u8F38\u5165\u5BC6\u78BC",3,"ngModelChange","ngModel"],[1,"button-container"],[3,"click"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"div",1)(2,"input",2),h("ngModelChange",function(r){return f(t.loginName,r)||(t.loginName=r),r}),a(),s(3,"input",3),h("ngModelChange",function(r){return f(t.loginPassword,r)||(t.loginPassword=r),r}),a(),s(4,"div",4)(5,"button",5),m("click",function(){return t.loginUser()}),d(6,"\u767B\u5165"),a(),s(7,"button",5),m("click",function(){return t.cancelLogin()}),d(8,"\u53D6\u6D88"),a()()()()),e&2&&(l(2),_("ngModel",t.loginName),l(),_("ngModel",t.loginPassword))},dependencies:[v,V,k,R],styles:[".container[_ngcontent-%COMP%]{margin:50px;display:flex;justify-content:center;align-items:center}.login-container[_ngcontent-%COMP%]{margin:50px;padding:10px;display:flex;flex-direction:column;justify-content:center;align-items:center;border-radius:30px;border:1px solid var(--text-color);width:300px}input[_ngcontent-%COMP%]{margin:10px;padding:10px;border-radius:5px;border:1px solid #ccc;width:200px;height:10px}"]})};var U=class o{closeAlert=new w;alertMessage="";constructor(){}Alert(n){n()}close(){this.closeAlert.emit(!1)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["app-user-alert"]],inputs:{alertMessage:"alertMessage"},outputs:{closeAlert:"closeAlert"},decls:7,vars:1,consts:[[1,"outer"],[1,"alert_container"],[3,"click"]],template:function(e,t){e&1&&(s(0,"div")(1,"div",0)(2,"div",1)(3,"div"),d(4),a()(),s(5,"button",2),m("click",function(){return t.close()}),d(6,"\u78BA\u5B9A"),a()()()),e&2&&(l(4),P(t.alertMessage))},styles:[".outer[_ngcontent-%COMP%]{height:150px;width:250px;position:absolute;background-color:#f8f9fa;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;padding:3px;flex-direction:column;border:1px solid #ccc;border-radius:10px;box-shadow:0 0 10px #0000001a;z-index:999}.alert_container[_ngcontent-%COMP%]{display:grid;align-items:center;height:100%;padding:20px;background-color:#f8f9fa;color:#000;font-size:16px;font-weight:500;justify-items:center;text-align:center}button[_ngcontent-%COMP%]{height:40px;border:1px solid #ccc;border-radius:5px;background-color:#d2e0ed}"]})};function ne(o,n){if(o&1){let e=x();s(0,"div",4)(1,"div",5),m("click",function(){p(e);let i=c();return g(i.showPage("regist"))}),d(2,"\u8A3B\u518A"),a(),s(3,"div",5),m("click",function(){p(e);let i=c();return g(i.showPage("login"))}),d(4,"\u767B\u5165"),a()()}}function ie(o,n){if(o&1){let e=x();s(0,"app-regist",6),m("finishRegist",function(i){p(e);let r=c();return g(r.onFinish(i))})("cancel",function(i){p(e);let r=c();return g(r.onCancel(i))}),a()}}function re(o,n){if(o&1){let e=x();s(0,"app-login",7),m("finishLogin",function(i){p(e);let r=c();return g(r.onFinish(i))})("cancel",function(i){p(e);let r=c();return g(r.onCancel(i))}),a()}}function oe(o,n){if(o&1){let e=x();s(0,"app-user-alert",8),m("closeAlert",function(i){p(e);let r=c();return g(r.onClosedAlert(i))}),a()}if(o&2){let e=c();u("alertMessage",e.alertMessage)}}var K=class o{constructor(n,e,t){this.userSrv=n;this.authSrv=e;this.router=t}alert=new U;alertMessage="";showAlert=!1;showRegistPage=!1;showLoginPage=!1;ngOnInit(){}showPage(n){n==="login"?(this.showLoginPage=!0,this.showRegistPage=!1):(this.showRegistPage=!0,this.showLoginPage=!1)}onFinish(n){let e=n;e.result?(this.alertMessage=e.message,this.alert.Alert(()=>{this.showRegistPage=!1,this.showLoginPage=!1})):(this.alertMessage=e.message,this.alert.Alert(()=>{})),this.showAlert=!0}onCancel(n){this.showRegistPage=n,this.showLoginPage=n}onClosedAlert(n){this.showAlert=n,localStorage.getItem("token")&&this.router.navigate(["/"])}getUserInfo(n){return S(this,null,function*(){try{let e=localStorage.getItem("token");if(!e){console.log("\u8ACB\u5148\u767B\u5165");return}this.userSrv.getUserInfo(e,n).subscribe({next:t=>{if(t.status===200){console.log("\u67E5\u8A62\u6210\u529F");let i=t.data[0];this.authSrv.loginUser(i)}else console.log("\u67E5\u8A62\u5931\u6557")},error:t=>{throw console.log(`\u67E5\u8A62\u5931\u6557\uFF1A${t.status}`,t.message),t}})}catch(e){console.error("\u67E5\u8A62\u5931\u6557",e)}})}deleteUser(n){return S(this,null,function*(){try{let e=localStorage.getItem("token");if(!e){console.log("\u8ACB\u5148\u767B\u5165");return}n&&n!==0?this.userSrv.deleteUser(e,n).subscribe({next:t=>{t.status===200?console.log("\u522A\u9664\u6210\u529F"):console.log("\u4E0D\u660E\u539F\u56E0\u522A\u9664\u5931\u6557")},error:t=>{throw console.log(`\u522A\u9664\u5931\u6557\uFF1A${t.status}`,t.message),t}}):console.log("\u8ACB\u8F38\u5165\u6709\u6548ID")}catch(e){console.error("\u522A\u9664\u5931\u6557",e)}})}logoutUser(){this.authSrv.logoutUser(),localStorage.removeItem("token")}static \u0275fac=function(e){return new(e||o)(C(M),C(I),C(H))};static \u0275cmp=y({type:o,selectors:[["app-user-system"]],decls:5,vars:4,consts:[["class","button-container",4,"ngIf"],[3,"finishRegist","cancel",4,"ngIf"],[3,"finishLogin","cancel",4,"ngIf"],[3,"alertMessage","closeAlert",4,"ngIf"],[1,"button-container"],[1,"user-system-block",3,"click"],[3,"finishRegist","cancel"],[3,"finishLogin","cancel"],[3,"closeAlert","alertMessage"]],template:function(e,t){e&1&&(s(0,"div"),b(1,ne,5,0,"div",0)(2,ie,1,0,"app-regist",1)(3,re,1,0,"app-login",2),a(),b(4,oe,1,1,"app-user-alert",3)),e&2&&(l(),u("ngIf",!t.showLoginPage&&!t.showRegistPage),l(),u("ngIf",t.showRegistPage),l(),u("ngIf",t.showLoginPage),l(),u("ngIf",t.showAlert))},dependencies:[v,E,O,D,U],styles:[".button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin:10px}.user-system-block[_ngcontent-%COMP%]{width:200px;height:150px;display:flex;flex-wrap:wrap;border-radius:30px;justify-content:center;align-items:center;font-size:2rem;letter-spacing:.5rem;margin:10px;background-color:var(--block-color)}.user-system-block[_ngcontent-%COMP%]:hover{cursor:pointer;transform:translate(10px,-10px);transition:transform .3s ease;box-shadow:-2px 2px 5px 2px #ffffff80}"]})};export{K as UserSystemComponent};
